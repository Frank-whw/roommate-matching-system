# 室友匹配系统测试指南

## 概述

本文档提供了室友匹配系统的全面测试指南，包括功能测试、集成测试和用户体验测试。

## 测试环境设置

### 前置条件
- Node.js 18+
- PostgreSQL 数据库运行中
- 环境变量配置正确

### 启动测试环境
```bash
# 安装依赖
npm install

# 运行数据库迁移
npm run db:migrate

# 启动开发服务器
npm run dev

# 服务运行在 http://localhost:3000
```

## 功能测试清单

### 🔐 认证系统测试

#### 用户注册
- [ ] 学号格式验证 (102*55014**格式)
  - ✅ 正确格式：`10215501401` 应该通过
  - ❌ 错误格式：`123456` 应该失败
  - ❌ 错误格式：`10215501` 应该失败
- [ ] 同意条款验证
  - ❌ 未勾选同意条款应该阻止提交
  - ✅ 勾选同意条款应该允许提交
- [ ] 邮件发送验证
  - [ ] 注册成功后应在控制台显示邮件内容
  - [ ] 邮件包含正确的设置密码链接
- [ ] 重复注册验证
  - [ ] 相同学号重复注册应该失败

#### 密码设置
- [ ] 密码强度验证
  - ❌ 少于8位：`123456` 应该失败
  - ❌ 无大写字母：`password123` 应该失败
  - ❌ 无小写字母：`PASSWORD123` 应该失败
  - ❌ 无数字：`Password` 应该失败
  - ✅ 符合要求：`Password123` 应该成功
- [ ] 密码确认验证
  - ❌ 两次密码不一致应该失败
  - ✅ 两次密码一致应该成功
- [ ] Token验证
  - ❌ 无效token应该失败
  - ❌ 过期token应该失败
  - ✅ 有效token应该成功

#### 用户登录
- [ ] 学号密码验证
  - ❌ 错误学号应该失败
  - ❌ 错误密码应该失败
  - ❌ 未验证邮箱应该失败
  - ✅ 正确凭据应该成功
- [ ] 登录状态保持
  - [ ] 成功登录后应重定向到dashboard
  - [ ] 刷新页面应保持登录状态

### 👤 个人资料测试

#### 资料完善
- [ ] 必填字段验证
  - [ ] 微信号格式验证
  - [ ] 年龄范围验证 (16-35)
  - [ ] 时间格式验证 (HH:mm)
- [ ] 字符长度限制
  - [ ] 个人简介不超过500字
  - [ ] 室友期待不超过1000字
  - [ ] 兴趣爱好不超过500字
- [ ] 完成度计算
  - [ ] 填写字段数量正确反映在进度条
  - [ ] 至少50%才能保存
- [ ] 保存功能
  - [ ] 成功保存后显示成功消息
  - [ ] 页面刷新后数据应保持

### 💖 匹配系统测试

#### 用户发现
- [ ] 用户列表加载
  - [ ] 应显示其他用户的公开资料
  - [ ] 不应显示当前用户自己
  - [ ] 分页功能正常
- [ ] 筛选功能
  - [ ] 按性别筛选
  - [ ] 按MBTI类型筛选
  - [ ] 按学习习惯筛选

#### 点赞和匹配
- [ ] 点赞功能
  - [ ] 点赞按钮状态更新
  - [ ] 重复点赞应提示已点赞
- [ ] 匹配机制
  - [ ] 双向点赞产生匹配
  - [ ] 匹配成功显示通知
- [ ] 匹配列表
  - [ ] 显示所有匹配的用户
  - [ ] 可以取消匹配

### 👥 队伍系统测试

#### 队伍创建
- [ ] 基本信息验证
  - [ ] 队伍名称长度限制
  - [ ] 队伍描述长度限制
  - [ ] 最大成员数限制 (2-4人)
- [ ] 创建权限
  - [ ] 已有队伍的用户不能创建新队伍
  - [ ] 创建成功后成为队长

#### 队伍加入
- [ ] 申请发送
  - [ ] 申请消息长度限制
  - [ ] 重复申请验证
- [ ] 申请审核
  - [ ] 只有队长可以审核
  - [ ] 批准后成员加入队伍
  - [ ] 拒绝后申请状态更新

#### 队伍管理
- [ ] 队长权限
  - [ ] 移除成员
  - [ ] 转移队长
  - [ ] 解散队伍
- [ ] 成员权限
  - [ ] 退出队伍
  - [ ] 查看队伍信息

### 🔔 实时通知测试

#### 通知生成
- [ ] 新匹配通知
- [ ] 队伍申请通知
- [ ] 申请状态变化通知
- [ ] 新点赞通知

#### 通知显示
- [ ] 通知中心图标更新
- [ ] 下拉列表显示通知
- [ ] Toast弹出通知
- [ ] 点击外部关闭通知

## 集成测试

### API端点测试

使用curl或Postman测试以下端点：

```bash
# 注册
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"studentId":"10215501401","agreeToTerms":true}'

# 登录
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"studentId":"10215501401","password":"Password123"}'

# 获取用户列表
curl -X GET http://localhost:3000/api/users

# 获取个人资料
curl -X GET http://localhost:3000/api/profile

# 创建队伍
curl -X POST http://localhost:3000/api/teams \
  -H "Content-Type: application/json" \
  -d '{"name":"测试队伍","description":"这是一个测试队伍","maxMembers":4}'
```

### 数据库测试

- [ ] 数据迁移完整性
- [ ] 外键约束正确性
- [ ] 数据一致性检查
- [ ] 性能查询测试

## 用户体验测试

### 响应式设计
- [ ] 桌面端 (1920x1080)
- [ ] 平板端 (768x1024)
- [ ] 手机端 (375x667)

### 浏览器兼容性
- [ ] Chrome (最新版)
- [ ] Firefox (最新版)
- [ ] Safari (最新版)
- [ ] Edge (最新版)

### 可访问性测试
- [ ] 键盘导航
- [ ] 屏幕阅读器支持
- [ ] 颜色对比度
- [ ] 字体大小调整

### 性能测试
- [ ] 页面加载时间 < 3秒
- [ ] 首次内容绘制 < 1.5秒
- [ ] 交互响应时间 < 100ms
- [ ] API响应时间 < 500ms

## 错误处理测试

### 网络错误
- [ ] 断网情况下的错误提示
- [ ] 超时请求的处理
- [ ] 5xx服务器错误的处理

### 表单验证
- [ ] 客户端验证反馈
- [ ] 服务端验证错误显示
- [ ] 实时字段验证

### 边界条件
- [ ] 空数据处理
- [ ] 特殊字符输入
- [ ] 超长字符串输入
- [ ] SQL注入防护

## 测试数据

### 测试用户

创建以下测试账户进行测试：

1. **用户A**: 10215501401
2. **用户B**: 10215501402  
3. **用户C**: 10215501403
4. **用户D**: 10215501404

### 测试场景

1. **完整注册流程**: 用户A从注册到设置密码到登录
2. **匹配流程**: 用户A和用户B相互点赞产生匹配
3. **队伍流程**: 用户A创建队伍，用户B申请加入
4. **权限测试**: 非队长用户尝试队伍管理操作

## 自动化测试 (未来规划)

### 单元测试
```bash
# 运行Jest单元测试
npm run test

# 运行测试覆盖率
npm run test:coverage
```

### E2E测试
```bash
# 运行Playwright E2E测试
npm run test:e2e

# 运行特定测试套件
npm run test:e2e -- --grep "登录流程"
```

## 问题报告模板

发现问题时，请使用以下模板报告：

```
**Bug标题**: [简短描述问题]

**严重级别**: [高/中/低]

**复现步骤**:
1. 步骤1
2. 步骤2
3. 步骤3

**预期结果**: [应该发生什么]

**实际结果**: [实际发生了什么]

**环境信息**:
- 浏览器版本：
- 操作系统：
- 屏幕分辨率：

**附加信息**: [错误截图、控制台日志等]
```

## 测试完成标准

- [ ] 所有功能测试用例通过
- [ ] 所有API端点正常响应
- [ ] 响应式设计在各设备正常
- [ ] 错误处理机制完善
- [ ] 性能指标达标
- [ ] 安全测试通过

## 测试报告

测试完成后，整理测试报告包含：
1. 测试用例执行结果
2. 发现的问题及修复状态
3. 性能测试数据
4. 用户体验评估
5. 部署建议